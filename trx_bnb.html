<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GasSwap – Cross-Chain Swap</title>
  <meta name="description" content="Deposit TRX and receive BNB (BSC) automatically. Simple cross-chain swap request UI." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    a { word-break: break-all; }
    .disabled-link { opacity: 0.4; cursor: not-allowed; pointer-events: none; }
    .flag-btn { font-size: 20px; cursor: pointer; opacity: 0.7; transition: 0.2s; }
    .flag-btn:hover { opacity: 1; transform: scale(1.1); }
    .flag-active { opacity: 1; border-bottom: 2px solid #34d399; }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <!-- HEADER -->
  <header class="border-b border-slate-800 bg-slate-900/60 backdrop-blur sticky top-0 z-20">
    <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-xl bg-gradient-to-tr from-emerald-400 to-cyan-400"></div>
        <h1 class="text-lg font-semibold tracking-tight">GasSwap</h1>
        <span class="ml-2 text-xs text-slate-400">v1.0</span>
      </div>
      <!-- Language flags -->
      <div class="flex items-center gap-3 text-lg">
        <span class="flag-btn" data-lang="en">🇺🇸</span>
        <span class="flag-btn" data-lang="ko">🇰🇷</span>
        <span class="flag-btn" data-lang="ja">🇯🇵</span>
        <span class="flag-btn" data-lang="zh">🇨🇳</span>
        <span class="flag-btn" data-lang="es">🇪🇸</span>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-5xl mx-auto px-4 py-8">
    <!-- Title -->
    <section class="rounded-2xl border border-slate-800 bg-slate-900 p-6 mb-6 text-center">
      <h2 id="title" class="text-2xl font-semibold mb-1">TRX → BNB (BSC)</h2>
      <h3 class="text-sm text-slate-500 tracking-wide mb-2">Cross-Chain Swap</h3>
      <p id="subtitle" class="text-slate-400 text-sm">Deposit TRX and receive BNB (BSC) automatically after confirmation.</p>
    </section>

<!-- Swap Menu -->
<section class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3 mb-8">
  <a href="index.html" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">BNB → TRX</a>
  <a href="trx_bnb.html" class="text-center rounded-xl py-3 bg-emerald-500 text-slate-950 font-semibold">TRX → BNB</a>
  <button data-type="bnb-eth" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">BNB → ETH</button>
  <button data-type="eth-bnb" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">ETH → BNB</button>
  <button data-type="bnb-pol" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">BNB → POL</button>
  <button data-type="pol-bnb" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">POL → BNB</button>
</section>

<!-- Form + Session -->
<section class="grid md:grid-cols-2 gap-6">
  <!-- Left: Form -->
  <div class="rounded-2xl border border-slate-800 bg-slate-900 p-5">
    <h3 id="formTitle" class="text-lg font-semibold mb-4">Please fill this form before sending your tokens</h3>
    <form id="swapForm" class="space-y-4" novalidate>
      <div>
        <label id="labelSender" class="block text-sm mb-1">Sender (TRX)</label>
        <input id="sender" type="text" class="w-full rounded-xl bg-slate-950 border border-slate-800 focus:border-emerald-400 px-4 py-3 text-sm" placeholder="T…" required />
      </div>
      <div>
        <label id="labelReceiver" class="block text-sm mb-1">Receiver (BNB BSC)</label>
        <input id="receiver" type="text" class="w-full rounded-xl bg-slate-950 border border-slate-800 focus:border-emerald-400 px-4 py-3 text-sm" placeholder="0x…" required />
      </div>
      <div id="formError" class="hidden rounded-xl border border-red-500/40 bg-red-500/10 text-red-200 text-sm px-3 py-2"></div>
      <button id="startBtn" type="submit" class="w-full rounded-xl px-4 py-3 bg-emerald-500 text-slate-950 font-semibold hover:bg-emerald-400 focus:outline-none"> Start Swap </button>
    </form>

    <!-- Wallet Links -->
    <div id="userExplorers" class="hidden mt-5 text-sm text-slate-400 space-y-2 w-[95%] mx-auto">
      <div id="youCanCheck">Check Explorers:</div>
      <div class="mt-1"> 🔗 <a id="userTrxLink" target="_blank" class="underline hover:text-emerald-300">Tronscan(Sender)</a> </div>
      <div> 🔗 <a id="userBscLink" target="_blank" class="underline hover:text-emerald-300">BscScan(Receiver)</a> </div>
    </div>
  </div>

  <!-- Right: Session -->
  <div class="rounded-2xl border border-slate-800 bg-slate-900 p-5">
    <h3 id="sessionTitle" class="text-lg font-semibold mb-4">Deposit session</h3>
    <div id="inactiveHint" class="text-sm text-slate-400">
      Fill the form and press <span class="font-semibold">Start Swap</span> to generate your session.
    </div>
    <div id="sessionPanel" class="hidden space-y-4">
      <div>
        <div class="text-xs text-slate-400" id="depositTo">Deposit to (fixed address)</div>
        <div class="mt-1 flex items-center gap-2">
          <code id="depositAddress" class="text-emerald-200 break-all"></code>
          <button id="copyDeposit" class="text-xs px-2 py-1 rounded-lg border border-slate-700 hover:bg-slate-800">Copy</button>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <div id="qr" class="bg-white p-2 inline-block rounded-xl"></div>
          <div class="text-[10px] text-slate-500 mt-1" id="scanToDeposit">Scan to deposit</div>
        </div>
        <div>
          <div class="text-xs text-slate-400" id="deadlineLabel">Deposit deadline</div>
          <div id="countdown" class="text-3xl font-mono mt-1 text-right">01:00</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- NOTICE -->
<section class="mt-8 text-center">
  <div id="noticeBox" class="bg-yellow-500/10 border border-yellow-500/40 text-yellow-200 rounded-xl p-4 text-sm leading-relaxed">
    ⚠️ For security: deposits under 1 USDT or above 20 USDT are not accepted. Please send only small amounts for gas purposes.
  </div>
</section>

<!-- INFO SECTION -->
<section class="mt-10 max-w-3xl mx-auto text-sm leading-relaxed">
  <div class="rounded-2xl border border-emerald-500/40 bg-emerald-500/10 p-6 text-emerald-100">
    <h3 class="text-lg font-semibold mb-3 text-center text-emerald-300">Why Use GasSwap?</h3>
    <ul class="list-disc list-inside space-y-1">
      <li>No need to connect your wallet</li>
      <li>Lowest cross-swap fee: +0.5 USDT equivalent token per transaction</li>
      <li>Simple process: just send and receive</li>
      <li>Instant verification on blockchain explorers</li>
    </ul>
    <h3 class="text-lg font-semibold mt-6 mb-3 text-center text-emerald-300">How to Use</h3>
    <ol class="list-decimal list-inside space-y-1">
      <li>Enter both the <b>Sender</b> and <b>Receiver</b> wallet addresses correctly</li>
      <li>Send TRX to the displayed deposit address</li>
      <li>Receive BNB automatically (usually within 5 minutes depending on network conditions)</li>
      <li>To prevent automated attacks and speculative swaps, any transaction value outside the range of 1 – 20 USDT will be automatically refunded (minus a fee for processing).</li>
    </ol>
  </div>
</section>
</main>

<footer class="mt-10 py-10 text-center text-xs text-slate-500">
  © <span id="year"></span> GasSwap
</footer>

<script>
const CONFIG = {
  FORM_ENDPOINT: "https://gasswap-proxy.workers.dev",
  SERVER_TRX: "TDhFfK9nXvdp2kUq3pP7b3p7aYjV3kJb7T",
  SESSION_SECONDS: 3600
};

const $ = s => document.querySelector(s);
const isEVM = a => /^0x[0-9a-fA-F]{40}$/.test(a || "");
const isTRX = a => /^T[1-9A-HJ-NP-Za-km-z]{33}$/.test(a || "");

function makeQR(text) {
  $("#qr").innerHTML = "";
  new QRCode($("#qr"), { text, width: 160, height: 160, correctLevel: QRCode.CorrectLevel.M });
}

function showSession() {
  $("#inactiveHint").classList.add("hidden");
  $("#sessionPanel").classList.remove("hidden");
  $("#depositAddress").textContent = CONFIG.SERVER_TRX;
  makeQR(CONFIG.SERVER_TRX);
  startCountdown(CONFIG.SESSION_SECONDS);
  $("#userExplorers").classList.remove("hidden");
}

function startCountdown(s) {
  const el = $("#countdown");
  const end = Date.now() + s * 1000;
  const tick = () => {
    const r = Math.max(0, Math.floor((end - Date.now()) / 1000));
    const m = String(Math.floor(r / 60)).padStart(2, "0");
    const sec = String(r % 60).padStart(2, "0");
    el.textContent = `${m}:${sec}`;
    if (r > 0) setTimeout(tick, 1000);
  };
  tick();
}

// ✅ forms2.json으로 변경
async function updateForms(sender, receiver) {
  const repo = "GasSwap/gasswap-data";
  const path = "data/forms2.json";
  const url = `https://api.github.com/repos/${repo}/contents/${path}`;
  const res = await fetch(CONFIG.FORM_ENDPOINT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ sender, receiver, repo, path, url })
  });
  if (res.ok) alert("✅ Swap request saved to GitHub (forms2.json)!");
  else alert("❌ Error: " + await res.text());
}

// === FORM EVENT ===
document.addEventListener("DOMContentLoaded", () => {
  $("#year").textContent = new Date().getFullYear();

  $("#swapForm").addEventListener("submit", async e => {
    e.preventDefault();
    const sender = $("#sender").value.trim();
    const receiver = $("#receiver").value.trim();
    const err = $("#formError");
    if (!isTRX(sender)) {
      err.textContent = "Invalid TRX address";
      err.classList.remove("hidden");
      return;
    }
    if (!isEVM(receiver)) {
      err.textContent = "Invalid BSC address";
      err.classList.remove("hidden");
      return;
    }
    err.classList.add("hidden");
    $("#startBtn").disabled = true;
    $("#startBtn").classList.add("opacity-50", "cursor-not-allowed");
    showSession();
    $("#userTrxLink").href = `https://tronscan.org/#/address/${sender}`;
    $("#userBscLink").href = `https://bscscan.com/address/${receiver}`;
    await updateForms(sender, receiver);
  });
});
</script>
</body>
</html>
