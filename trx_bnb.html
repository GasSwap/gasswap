<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GasSwap â€“ TRX â†’ BNB (BSC)</title>
  <meta name="description" content="Deposit TRX and receive BNB (BSC) automatically. Simple cross-chain swap request UI." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    a { word-break: break-all; }
    .disabled-link { opacity: 0.4; cursor: not-allowed; pointer-events: none; }
    .flag-btn { font-size: 20px; cursor: pointer; opacity: 0.7; transition: 0.2s; }
    .flag-btn:hover { opacity: 1; transform: scale(1.1); }
    .flag-active { opacity: 1; border-bottom: 2px solid #34d399; }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">

  <!-- HEADER -->
  <header class="border-b border-slate-800 bg-slate-900/60 backdrop-blur sticky top-0 z-20">
    <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-xl bg-gradient-to-tr from-emerald-400 to-cyan-400"></div>
        <h1 class="text-lg font-semibold tracking-tight">GasSwap</h1>
        <span class="ml-2 text-xs text-slate-400">v1.0</span>
      </div>
      <!-- Language flags -->
      <div class="flex items-center gap-3 text-lg">
        <span class="flag-btn" data-lang="en">ğŸ‡ºğŸ‡¸</span>
        <span class="flag-btn" data-lang="ko">ğŸ‡°ğŸ‡·</span>
        <span class="flag-btn" data-lang="ja">ğŸ‡¯ğŸ‡µ</span>
        <span class="flag-btn" data-lang="zh">ğŸ‡¨ğŸ‡³</span>
        <span class="flag-btn" data-lang="es">ğŸ‡ªğŸ‡¸</span>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-5xl mx-auto px-4 py-8">

    <!-- Title -->
    <section class="rounded-2xl border border-slate-800 bg-slate-900 p-6 mb-6 text-center">
      <h2 id="title" class="text-2xl font-semibold mb-1">TRX â†’ BNB (BSC)</h2>
      <h3 class="text-sm text-slate-500 tracking-wide mb-2">Cross-Chain Swap</h3>
      <p id="subtitle" class="text-slate-400 text-sm">Deposit TRX and receive BNB (BSC) automatically after confirmation.</p>
    </section>

<!-- Swap Menu -->
<section class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3 mb-8">
  <a href="index.html" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">BNB â†’ TRX</a>
  <a href="trx_bnb.html" class="text-center rounded-xl py-3 bg-emerald-500 text-slate-950 font-semibold">TRX â†’ BNB</a>
  <button data-type="bnb-eth" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">BNB â†’ ETH</button>
  <button data-type="eth-bnb" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">ETH â†’ BNB</button>
  <button data-type="bnb-pol" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">BNB â†’ POL</button>
  <button data-type="pol-bnb" class="text-center rounded-xl py-3 bg-emerald-500/80 hover:bg-emerald-500 text-slate-950 font-semibold">POL â†’ BNB</button>
</section>

<!-- Form + Session -->
<section class="grid md:grid-cols-2 gap-6">
  <!-- Left: Form -->
  <div class="rounded-2xl border border-slate-800 bg-slate-900 p-5">
    <h3 id="formTitle" class="text-lg font-semibold mb-4">Please fill this form before sending your tokens</h3>
    <form id="swapForm" class="space-y-4" novalidate>
      <div>
        <label id="labelSender" class="block text-sm mb-1">Sender (TRX)</label>
        <input id="sender" type="text" class="w-full rounded-xl bg-slate-950 border border-slate-800 focus:border-emerald-400 px-4 py-3 text-sm" placeholder="T..." required />
      </div>
      <div>
        <label id="labelReceiver" class="block text-sm mb-1">Receiver (BNB BSC)</label>
        <input id="receiver" type="text" class="w-full rounded-xl bg-slate-950 border border-slate-800 focus:border-emerald-400 px-4 py-3 text-sm" placeholder="0xâ€¦" required />
      </div>
      <div id="formError" class="hidden rounded-xl border border-red-500/40 bg-red-500/10 text-red-200 text-sm px-3 py-2"></div>
      <button id="startBtn" type="submit" class="w-full rounded-xl px-4 py-3 bg-emerald-500 text-slate-950 font-semibold hover:bg-emerald-400 focus:outline-none"> Start Swap </button>
    </form>

    <!-- Wallet Links -->
    <div id="userExplorers" class="hidden mt-5 text-sm text-slate-400 space-y-2 w-[95%] mx-auto">
      <div id="youCanCheck">Check Explorers:</div>
      <div class="mt-1"> ğŸ”— <a id="userTrxLink" target="_blank" class="underline hover:text-emerald-300">Tronscan(Sender)</a> </div>
      <div> ğŸ”— <a id="userBscLink" target="_blank" class="underline hover:text-emerald-300">BscScan(Receiver)</a> </div>
    </div>
  </div>

  <!-- Right: Session -->
  <div class="rounded-2xl border border-slate-800 bg-slate-900 p-5">
    <h3 id="sessionTitle" class="text-lg font-semibold mb-4">Deposit session</h3>
    <div id="inactiveHint" class="text-sm text-slate-400"> Fill the form and press <span class="font-semibold">Start Swap</span> to generate your session. </div>
    <div id="sessionPanel" class="hidden space-y-4">
      <div>
        <div class="text-xs text-slate-400" id="depositTo">Deposit to (fixed address)</div>
        <div class="mt-1 flex items-center gap-2">
          <code id="depositAddress" class="text-emerald-200 break-all"></code>
          <button id="copyDeposit" class="text-xs px-2 py-1 rounded-lg border border-slate-700 hover:bg-slate-800">Copy</button>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <div id="qr" class="bg-white p-2 inline-block rounded-xl"></div>
          <div class="text-[10px] text-slate-500 mt-1" id="scanToDeposit">Scan to deposit</div>
        </div>
        <div>
          <div class="text-xs text-slate-400" id="deadlineLabel">Deposit deadline</div>
          <div id="countdown" class="text-3xl font-mono mt-1 text-right">59:59</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- NOTICE -->
<section class="mt-8 text-center">
  <div id="noticeBox" class="bg-yellow-500/10 border border-yellow-500/40 text-yellow-200 rounded-xl p-4 text-sm leading-relaxed">
    âš ï¸ For security: deposits under 1 USDT or above 20 USDT are not accepted. Please send only small amounts for gas purposes.
  </div>
</section>

<!-- INFO SECTION -->
<section class="mt-10 max-w-3xl mx-auto text-sm leading-relaxed">
  <div class="rounded-2xl border border-emerald-500/40 bg-emerald-500/10 p-6 text-emerald-100">
    <h3 class="text-lg font-semibold mb-3 text-center text-emerald-300">Why Use GasSwap?</h3>
    <ul class="list-disc list-inside space-y-1">
      <li>No need to connect your wallet</li>
      <li>Lowest cross-swap fee: +0.5 USDT equivalent token per transaction</li>
      <li>Simple process: just send and receive</li>
      <li>Instant verification on blockchain explorers</li>
    </ul>
    <h3 class="text-lg font-semibold mt-6 mb-3 text-center text-emerald-300">How to Use</h3>
    <ol class="list-decimal list-inside space-y-1">
      <li>Enter both the <b>Sender</b> and <b>Receiver</b> wallet addresses correctly</li>
      <li>Send TRX to the displayed deposit address</li>
      <li>Receive BNB automatically (usually within 5 minutes depending on network conditions)</li>
      <li>To prevent automated attacks and speculative swaps, any transaction value outside the range of 1 â€“ 20 USDT will be automatically refunded (minus a fee for processing).</li>
    </ol>
  </div>
</section>

</main>

<!-- âœ… Modal (ê³µí†µ íŒì—…) -->
<div id="swapModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
  <div class="bg-slate-900 border border-slate-700 rounded-2xl max-w-md w-[90%] p-6 text-center relative">
    <button id="closeModal" class="absolute top-2 right-3 text-slate-400 hover:text-emerald-400 text-xl">âœ•</button>
    <h2 id="modalTitle" class="text-xl font-bold mb-2"></h2>
    <p id="modalDesc" class="text-slate-400 text-sm mb-4"></p>
    <div class="text-xs text-slate-400 mb-2" id="modalDepositLabel"></div>
    <code id="modalAddress" class="block text-emerald-300 break-all mb-3">0xDA1E8b362DDe013EA87Cf8984D64490c1900d231</code>
    <button id="copyAddr" class="px-3 py-2 rounded-lg border border-slate-700 hover:bg-slate-800 text-sm mb-4">Copy Address</button>
    <div id="modalQR" class="flex justify-center mb-4"></div>
    <div id="explorerLinks" class="space-y-1 text-sm text-slate-400"></div>
  </div>
</div>

<footer class="mt-10 py-10 text-center text-xs text-slate-500">
  Â© <span id="year"></span> GasSwap
</footer>


<script>
/* === ìµœì†Œ ë³€ê²½ ì›ì¹™: TRXâ†”BSC ë°©í–¥ ì „í™˜ + JSON íŒŒì¼ ê²½ë¡œë§Œ === */

const CONFIG = {
  FORM_ENDPOINT: "https://gasswap-proxy.workers.dev",
  // âš ï¸ ì‚¬ìš©ìê°€ ì œê³µí•œ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤ (ì£¼ì†Œ ë¬¸ìì—´ë„ ë³€ê²½í•˜ì§€ ì•ŠìŒ)
  SERVER_BSC: "0xDA1E8b362DDe013EA87Cf8984D64490c1900d231",
  SESSION_SECONDS: 3600
};

/* ë‹¤êµ­ì–´ (TRX â†’ BNB ë¬¸êµ¬ë¡œ êµ¬ì„±) */
const I18N = {
  en: {
    title:"TRX â†’ BNB (BSC)",
    subtitle:"Deposit TRX and receive BNB (BSC) automatically after confirmation.",
    formTitle:"Please fill this form before sending your tokens",
    labelSender:"Sender (TRX)",
    labelReceiver:"Receiver (BNB BSC)",
    start:"Start Swap",
    sessionTitle:"Deposit session",
    depositTo:"Deposit to (fixed address)",
    scanToDeposit:"Scan to deposit",
    deadlineLabel:"Deposit deadline",
    youCanCheck:"Check Explorers:",
    viewTrx:"Tronscan(Sender)",
    viewBsc:"BscScan(Receiver)",
    why:"Why Use GasSwap?",
    whyList:[
      "No need to connect your wallet",
      "Lowest cross-swap fee: +0.5 USDT equivalent token per transaction",
      "Simple process: just send and receive",
      "Instant verification on blockchain explorers"
    ],
    how:"How to Use",
    howList:[
      "Enter both the Sender and Receiver wallet addresses correctly",
      "Send TRX to the displayed deposit address",
      "Receive BNB automatically (usually within 5 minutes depending on network conditions)",
      "To prevent automated attacks and speculative swaps, any transaction value outside the range of 1 â€“ 20 USDT will be automatically refunded (minus a fee for processing)."
    ],
    notice:"âš ï¸ For security: deposits under 1 USDT or above 20 USDT are not accepted. Please send only small amounts for gas purposes.",
    err_sender:"Invalid TRX address",
    err_receiver:"Invalid BSC address"
  },
  ko: {
    title:"TRX â†’ BNB (BSC)",
    subtitle:"TRXë¥¼ ì…ê¸ˆí•˜ë©´ í™•ì¸ í›„ BNB(BSC)ê°€ ìë™ ì „ì†¡ë©ë‹ˆë‹¤.",
    formTitle:"í† í°ì„ ë³´ë‚´ê¸° ì „ì— ë¨¼ì € ì‘ì„±í•˜ì„¸ìš”",
    labelSender:"ë³´ë‚´ëŠ” ì§€ê°‘ (TRX)",
    labelReceiver:"ë°›ëŠ” ì§€ê°‘ (BNB BSC)",
    start:"ìŠ¤ì™‘ ì‹œì‘í•˜ê¸°",
    sessionTitle:"ì…ê¸ˆ ì„¸ì…˜",
    depositTo:"ì…ê¸ˆ ì£¼ì†Œ (ê³ ì •)",
    scanToDeposit:"ì…ê¸ˆìš© QR ì½”ë“œ",
    deadlineLabel:"ì…ê¸ˆ ì œí•œì‹œê°„",
    youCanCheck: "íƒìƒ‰ê¸°ì—ì„œ í™•ì¸í•˜ê¸°:",
    viewTrx: "Tronscan (ë³´ë‚´ëŠ” ì§€ê°‘)",
    viewBsc: "BscScan (ë°›ëŠ” ì§€ê°‘)",
    why:"ì™œ GasSwapì„ ì‚¬ìš©í•˜ë‚˜ìš”?",
    whyList:[
      "ì§€ê°‘ ì—°ê²°ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤",
      "ìµœì € ìŠ¤ì™‘ ìˆ˜ìˆ˜ë£Œ: ê±°ë˜ë‹¹ 0.5 USDT ìƒë‹¹ í† í°",
      "ê°„ë‹¨í•œ ì ˆì°¨: ë³´ë‚´ê³  ë°›ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤",
      "ë¸”ë¡ì²´ì¸ íƒìƒ‰ê¸°ì—ì„œ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥"
    ],
    how:"ì‚¬ìš© ë°©ë²•",
    howList:[
      "ë³´ë‚´ëŠ” ì§€ê°‘ê³¼ ë°›ëŠ” ì§€ê°‘ ì£¼ì†Œë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”",
      "í‘œì‹œëœ ì…ê¸ˆ ì£¼ì†Œë¡œ TRXë¥¼ ì „ì†¡í•˜ì„¸ìš”",
      "ë„¤íŠ¸ì›Œí¬ ìƒí™©ì— ë”°ë¼ ì•½ 5ë¶„ ë‚´ BNBê°€ ìë™ ì…ê¸ˆë©ë‹ˆë‹¤",
      "ìë™ ê³µê²© ë° íˆ¬ê¸°ì„± ìŠ¤ì™‘ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ 1~20 USDT ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ê±°ë˜ëŠ” ì²˜ë¦¬ ìˆ˜ìˆ˜ë£Œë¥¼ ì œì™¸í•˜ê³  ìë™ í™˜ë¶ˆë©ë‹ˆë‹¤."
    ],
    notice:"âš ï¸ ìë™ ê³µê²© ë°©ì§€ ë° ê°€ìŠ¤ ë³´í˜¸ë¥¼ ìœ„í•´ 1 USDT ë¯¸ë§Œ ë˜ëŠ” 20 USDT ì´ˆê³¼ ì…ê¸ˆì€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°€ìŠ¤ ëª©ì ì˜ ì†Œì•¡ë§Œ ì „ì†¡í•´ì£¼ì„¸ìš”.",
    err_sender:"TRX ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.",
    err_receiver:"BNB(BSC) ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
  },
  ja: {
    title:"TRX â†’ BNB (BSC)",
    subtitle:"TRXã‚’å…¥é‡‘ã™ã‚‹ã¨ã€ç¢ºèªå¾Œã«BNB(BSC)ãŒè‡ªå‹•é€ä»˜ã•ã‚Œã¾ã™ã€‚",
    formTitle:"ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ã‚‹å‰ã«ã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„",
    labelSender:"é€ä¿¡å…ƒ (TRX)",
    labelReceiver:"å—ä¿¡å…ˆ (BNB BSC)",
    start:"ã‚¹ãƒ¯ãƒƒãƒ—é–‹å§‹",
    sessionTitle:"å…¥é‡‘ã‚»ãƒƒã‚·ãƒ§ãƒ³",
    depositTo:"å…¥é‡‘å…ˆã‚¢ãƒ‰ãƒ¬ã‚¹ (å›ºå®š)",
    scanToDeposit:"å…¥é‡‘ç”¨QRã‚³ãƒ¼ãƒ‰",
    deadlineLabel:"å…¥é‡‘æœŸé™",
    youCanCheck: "ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç¢ºèª:",
    viewTrx: "Tronscanï¼ˆé€ä¿¡å…ƒï¼‰",
    viewBsc: "BscScanï¼ˆå—ä¿¡å…ˆï¼‰",
    why:"ãªãœGasSwapã‚’ä½¿ã†ã®ã‹ï¼Ÿ",
    whyList:[
      "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šã¯ä¸è¦",
      "æœ€å®‰ã®ã‚¯ãƒ­ã‚¹ã‚¹ãƒ¯ãƒƒãƒ—æ‰‹æ•°æ–™ï¼šå–å¼•ã”ã¨ã«0.5 USDTç›¸å½“",
      "ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹é †ï¼šé€ã‚‹ã ã‘ã§OK",
      "ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã§å³æ™‚ç¢ºèªå¯èƒ½"
    ],
    how:"ä½¿ã„æ–¹",
    howList:[
      "é€ä¿¡å…ƒã¨å—ä¿¡å…ˆã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„",
      "è¡¨ç¤ºã•ã‚ŒãŸå…¥é‡‘å…ˆã‚¢ãƒ‰ãƒ¬ã‚¹ã«TRXã‚’é€ä¿¡ã—ã¾ã™",
      "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ã«ã‚ˆã‚Šç´„5åˆ†ä»¥å†…ã«BNBã‚’è‡ªå‹•å—ä¿¡ã—ã¾ã™",
      "è‡ªå‹•æ”»æ’ƒã‚„æŠ•æ©Ÿçš„ãªã‚¹ãƒ¯ãƒƒãƒ—ã‚’é˜²ããŸã‚ã€1ï½20 USDTã®ç¯„å›²å¤–ã®å–å¼•ã¯æ‰‹æ•°æ–™ã‚’å·®ã—å¼•ã„ã¦è‡ªå‹•è¿”é‡‘ã•ã‚Œã¾ã™ã€‚"
    ],
    notice:"âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€1 USDTæœªæº€ã¾ãŸã¯20 USDTè¶…ã®å…¥é‡‘ã¯å—ã‘ä»˜ã‘ã¾ã›ã‚“ã€‚ã‚¬ã‚¹ç›®çš„ã®å°‘é¡ã®ã¿ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚",
    err_sender:"TRXã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç„¡åŠ¹ã§ã™ã€‚",
    err_receiver:"BSCã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç„¡åŠ¹ã§ã™ã€‚"
  },
  zh: {
    title:"TRX â†’ BNB (BSC)",
    subtitle:"å…¥é‡‘ TRXï¼Œç¡®è®¤åè‡ªåŠ¨æ”¶åˆ° BNBï¼ˆBSCï¼‰ã€‚",
    formTitle:"è¯·åœ¨å‘é€ä»£å¸å‰å¡«å†™æ­¤è¡¨å•",
    labelSender:"å‘é€åœ°å€ (TRX)",
    labelReceiver:"æ¥æ”¶åœ°å€ (BNB BSC)",
    start:"å¼€å§‹å…‘æ¢",
    sessionTitle:"å…¥é‡‘ä¼šè¯",
    depositTo:"å…¥é‡‘åœ°å€ï¼ˆå›ºå®šï¼‰",
    scanToDeposit:"æ‰«æäºŒç»´ç å…¥é‡‘",
    deadlineLabel:"å…¥é‡‘æˆªæ­¢æ—¶é—´",
    youCanCheck: "æŸ¥çœ‹åŒºå—æµè§ˆå™¨ï¼š",
    viewTrx: "Tronscanï¼ˆå‘é€åœ°å€ï¼‰",
    viewBsc: "BscScanï¼ˆæ¥æ”¶åœ°å€ï¼‰",
    why:"ä¸ºä»€ä¹ˆä½¿ç”¨GasSwapï¼Ÿ",
    whyList:[
      "æ— éœ€è¿æ¥é’±åŒ…",
      "æœ€ä½è·¨é“¾è´¹ç”¨ï¼šæ¯ç¬”äº¤æ˜“+0.5 USDTç­‰å€¼ä»£å¸",
      "æ“ä½œç®€å•ï¼šåªéœ€å‘é€å’Œæ¥æ”¶",
      "å¯åœ¨åŒºå—é“¾æµè§ˆå™¨ä¸Šå³æ—¶éªŒè¯"
    ],
    how:"ä½¿ç”¨æ–¹æ³•",
    howList:[
      "æ­£ç¡®è¾“å…¥å‘é€å’Œæ¥æ”¶é’±åŒ…åœ°å€",
      "å‘æ˜¾ç¤ºçš„å­˜æ¬¾åœ°å€å‘é€TRX",
      "é€šå¸¸5åˆ†é’Ÿå†…è‡ªåŠ¨æ”¶åˆ°BNBï¼ˆè§†ç½‘ç»œæƒ…å†µè€Œå®šï¼‰",
      "ä¸ºé˜²æ­¢è‡ªåŠ¨æ”»å‡»å’ŒæŠ•æœºæ€§äº¤æ¢ï¼Œè¶…å‡º1â€“20 USDTèŒƒå›´çš„äº¤æ˜“å°†è‡ªåŠ¨é€€æ¬¾ï¼ˆæ‰£é™¤å¤„ç†è´¹ç”¨ï¼‰ã€‚"
    ],
    notice:"âš ï¸ ä¸ºäº†å®‰å…¨ï¼Œè¯·å‹¿è½¬å…¥1 USDTä»¥ä¸‹æˆ–20 USDTä»¥ä¸Šé‡‘é¢ã€‚ä»…ç”¨äºGasçš„å°é¢å…¥é‡‘ã€‚",
    err_sender:"æ— æ•ˆçš„ TRX åœ°å€",
    err_receiver:"æ— æ•ˆçš„ BSC åœ°å€"
  },
  es: {
    title:"TRX â†’ BNB (BSC)",
    subtitle:"Deposita TRX y recibe BNB (BSC) automÃ¡ticamente tras la confirmaciÃ³n.",
    formTitle:"Por favor completa este formulario antes de enviar tus tokens",
    labelSender:"Remitente (TRX)",
    labelReceiver:"Receptor (BNB BSC)",
    start:"Iniciar intercambio",
    sessionTitle:"SesiÃ³n de depÃ³sito",
    depositTo:"Depositar en (direcciÃ³n fija)",
    scanToDeposit:"Escanear para depositar",
    deadlineLabel:"Plazo de depÃ³sito",
    youCanCheck: "Ver exploradores:",
    viewTrx: "Tronscan (Remitente)",
    viewBsc: "BscScan (Receptor)",
    why:"Â¿Por quÃ© usar GasSwap?",
    whyList:[
      "No necesitas conectar tu billetera",
      "Tarifa mÃ¡s baja: +0.5 USDT equivalente por transacciÃ³n",
      "Proceso simple: solo envÃ­a y recibe",
      "VerificaciÃ³n instantÃ¡nea en exploradores blockchain"
    ],
    how:"CÃ³mo usarlo",
    howList:[
      "Introduce correctamente las direcciones de remitente y receptor",
      "EnvÃ­a TRX a la direcciÃ³n mostrada",
      "Recibe BNB automÃ¡ticamente (normalmente dentro de 5 minutos, segÃºn la red)",
      "Para evitar ataques automÃ¡ticos y swaps especulativos, cualquier transacciÃ³n fuera del rango de 1â€“20 USDT serÃ¡ reembolsada automÃ¡ticamente (menos una tarifa de procesamiento)."
    ],
    notice:"âš ï¸ Por seguridad, no se aceptan depÃ³sitos menores a 1 USDT o mayores a 20 USDT. EnvÃ­a solo pequeÃ±as cantidades con fines de gas.",
    err_sender:"DirecciÃ³n TRX invÃ¡lida",
    err_receiver:"DirecciÃ³n BSC invÃ¡lida"
  }
};

const $ = s => document.querySelector(s);
const isEVM = a => /^0x[0-9a-fA-F]{40}$/.test(a || "");
const isTRX = a => /^T[1-9A-HJ-NP-Za-km-z]{33}$/.test(a || "");
let currentLang = "en";

async function detectLang() {
  try {
    const r = await fetch("https://ipapi.co/json/");
    const j = await r.json();
    const c = (j.country_code || "").toUpperCase();
    if (c === "KR") return "ko";
    if (c === "JP") return "ja";
    if (["CN","TW","HK","MO"].includes(c)) return "zh";
    if (["ES","MX","AR","CO","CL","PE"].includes(c)) return "es";
    return "en";
  } catch {
    return "en";
  }
}

function applyLang() {
  const t = I18N[currentLang];
  $("#title").textContent = t.title;
  $("#subtitle").textContent = t.subtitle;
  $("#formTitle").textContent = t.formTitle;
  $("#labelSender").textContent = t.labelSender;
  $("#labelReceiver").textContent = t.labelReceiver;
  $("#startBtn").textContent = t.start;
  $("#sessionTitle").textContent = t.sessionTitle;
  $("#depositTo").textContent = t.depositTo;
  $("#scanToDeposit").textContent = t.scanToDeposit;
  $("#deadlineLabel").textContent = t.deadlineLabel;
  $("#youCanCheck").textContent = t.youCanCheck;
  $("#noticeBox").textContent = t.notice;
  $("#userTrxLink").textContent = t.viewTrx;
  $("#userBscLink").textContent = t.viewBsc;

  // ì„¹ì…˜ í—¤ë”
  const headers = document.querySelectorAll("h3.text-emerald-300");
  if (headers[0]) headers[0].textContent = t.why;
  if (headers[1]) headers[1].textContent = t.how;

  // ë¦¬ìŠ¤íŠ¸ ë²ˆì—­
  const whyItems = document.querySelectorAll(".list-disc li");
  const howItems = document.querySelectorAll(".list-decimal li");
  if (t.whyList) whyItems.forEach((li, i) => t.whyList[i] && (li.textContent = t.whyList[i]));
  if (t.howList) howItems.forEach((li, i) => t.howList[i] && (li.textContent = t.howList[i]));
}

function highlightFlag() {
  document.querySelectorAll(".flag-btn").forEach(f =>
    f.classList.toggle("flag-active", f.dataset.lang === currentLang)
  );
}

function makeQR(text){
  $("#qr").innerHTML = "";
  new QRCode($("#qr"), { text, width:160, height:160, correctLevel: QRCode.CorrectLevel.M });
}

function showSession(){
  $("#inactiveHint").classList.add("hidden");
  $("#sessionPanel").classList.remove("hidden");
  // ì£¼ì†Œ í‘œì‹œëŠ” ê¸°ì¡´ ë³€ìˆ˜ ì´ë¦„ ìœ ì§€(ì‚¬ìš©ì ì§€ì‹œì— ë”°ë¼ ë‹¤ë¥¸ ë¶€ë¶„ ë³€ê²½í•˜ì§€ ì•ŠìŒ)
  $("#depositAddress").textContent = CONFIG.SERVER_BSC;
  makeQR(CONFIG.SERVER_BSC);
  startCountdown(CONFIG.SESSION_SECONDS);

  const explorers = $("#userExplorers");
  if (explorers) explorers.classList.remove("hidden");
}

function startCountdown(s){
  const el = $("#countdown");
  const end = Date.now() + s * 1000;
  const tick = ()=>{
    const r = Math.max(0, Math.floor((end - Date.now())/1000));
    const m = String(Math.floor(r/60)).padStart(2,"0");
    const sec = String(r%60).padStart(2,"0");
    el.textContent = `${m}:${sec}`;
    if (r>0) setTimeout(tick, 1000);
  };
  tick();
}

/* === JSON ê²½ë¡œë§Œ ë³€ê²½ (data/forms_trx_bnb.json) === */
async function updateForms(sender, receiver) {
  const repo = "GasSwap/gasswap-data";
  const path = "data/forms_trx_bnb.json"; // â† ì—¬ê¸°ë§Œ ë°”ê¿ˆ
  const url  = `https://api.github.com/repos/${repo}/contents/${path}`;

  const res = await fetch(CONFIG.FORM_ENDPOINT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ sender, receiver, repo, path, url })
  });

  if (res.ok) alert("âœ… Swap request saved to GitHub!");
  else alert("âŒ Error: " + await res.text());
}

document.addEventListener("DOMContentLoaded", async ()=>{
  $("#year").textContent = new Date().getFullYear();
  currentLang = await detectLang();
  applyLang();
  highlightFlag();

  document.querySelectorAll(".flag-btn").forEach(f =>
    f.addEventListener("click", () => {
      currentLang = f.dataset.lang;
      applyLang();
      highlightFlag();
    })
  );

  $("#copyDeposit").addEventListener("click", async ()=>{
    const addr = $("#depositAddress").textContent.trim();
    const btn = $("#copyDeposit");
    try {
      if (navigator.clipboard?.writeText) {
        await navigator.clipboard.writeText(addr);
      } else {
        const ta = document.createElement("textarea");
        ta.value = addr; document.body.appendChild(ta);
        ta.select(); document.execCommand("copy");
        document.body.removeChild(ta);
      }
      const prev = btn.textContent;
      btn.textContent = "Copied!";
      btn.classList.add("border-emerald-500");
      setTimeout(()=>{ btn.textContent = prev; btn.classList.remove("border-emerald-500"); },1500);
    } catch {
      alert("Copy failed. Please copy manually.");
    }
  });

  // TRX(sender) / BSC(receiver) ê²€ì¦ìœ¼ë¡œ ì „í™˜
  $("#swapForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const sender = $("#sender").value.trim();
    const receiver = $("#receiver").value.trim();
    const err = $("#formError");
    const t = I18N[currentLang];

    if (!isTRX(sender))   { err.textContent = t.err_sender;   err.classList.remove("hidden"); return; }
    if (!isEVM(receiver)) { err.textContent = t.err_receiver; err.classList.remove("hidden"); return; }
    err.classList.add("hidden");

    $("#startBtn").disabled = true;
    $("#startBtn").classList.add("opacity-50","cursor-not-allowed");

    showSession();
    // íƒìƒ‰ê¸° ë§í¬ë„ TRX(sender) / BSC(receiver)ë¡œ ì „í™˜
    $("#userTrxLink").href = `https://tronscan.org/#/address/${sender}`;
    $("#userBscLink").href = `https://bscscan.com/address/${receiver}`;

    await updateForms(sender, receiver);
  });
});

/* ===== ëª¨ë‹¬ (ë‹¤ë¥¸ ìŠ¤ì™‘ë“¤ ì•ˆë‚´) : ê¸°ëŠ¥ ìœ ì§€ ===== */
const swapPairs = {
  "bnb-eth": {
    title: "BNB â†’ ETH",
    desc: {
      en: "Send BNB (BSC) to the address below. The same address will automatically return ETH after confirmation.",
      ko: "ì•„ë˜ ì£¼ì†Œë¡œ BNB(BSC)ë¥¼ ë³´ë‚´ì„¸ìš”. í™•ì¸ í›„ ë™ì¼í•œ ì£¼ì†Œë¡œ ETHê°€ ìë™ ë°˜í™˜ë©ë‹ˆë‹¤.",
      ja: "ä¸‹è¨˜ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«BNB(BSC)ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚ç¢ºèªå¾Œã€åŒã˜ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ETHãŒè‡ªå‹•è¿”é€ã•ã‚Œã¾ã™ã€‚",
      zh: "è¯·å°†BNB(BSC)å‘é€è‡³ä»¥ä¸‹åœ°å€ã€‚ç¡®è®¤åï¼ŒåŒä¸€åœ°å€å°†è‡ªåŠ¨è¿”å›ETHã€‚",
      es: "EnvÃ­a BNB (BSC) a la siguiente direcciÃ³n. La misma direcciÃ³n devolverÃ¡ automÃ¡ticamente ETH despuÃ©s de la confirmaciÃ³n."
    },
    label: {
      en: "Deposit Address (BSC)",
      ko: "ì…ê¸ˆ ì£¼ì†Œ (BSC)",
      ja: "å…¥é‡‘ã‚¢ãƒ‰ãƒ¬ã‚¹ (BSC)",
      zh: "å…¥é‡‘åœ°å€ï¼ˆBSCï¼‰",
      es: "DirecciÃ³n de depÃ³sito (BSC)"
    },
    explorers: {
      en: ["BscScan (Sender)", "Etherscan (Receiver)"],
      ko: ["BscScan (ë³´ë‚´ëŠ” ì§€ê°‘)", "Etherscan (ë°›ëŠ” ì§€ê°‘)"],
      ja: ["BscScanï¼ˆé€ä¿¡å…ƒï¼‰", "Etherscanï¼ˆå—ä¿¡å…ˆï¼‰"],
      zh: ["BscScanï¼ˆå‘é€åœ°å€ï¼‰", "Etherscanï¼ˆæ¥æ”¶åœ°å€ï¼‰"],
      es: ["BscScan (Remitente)", "Etherscan (Receptor)"]
    },
    urls: ["https://bscscan.com/address/","https://etherscan.io/address/"]
  },
  "eth-bnb": {
    title: "ETH â†’ BNB",
    desc: {
      en: "Send ETH to the address below. The same address will automatically return BNB after confirmation.",
      ko: "ì•„ë˜ ì£¼ì†Œë¡œ ETHë¥¼ ë³´ë‚´ì„¸ìš”. í™•ì¸ í›„ ë™ì¼í•œ ì£¼ì†Œë¡œ BNBê°€ ìë™ ë°˜í™˜ë©ë‹ˆë‹¤.",
      ja: "ä¸‹è¨˜ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ETHã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚ç¢ºèªå¾Œã€åŒã˜ã‚¢ãƒ‰ãƒ¬ã‚¹ã«BNBãŒè‡ªå‹•è¿”é€ã•ã‚Œã¾ã™ã€‚",
      zh: "è¯·å°†ETHå‘é€è‡³ä»¥ä¸‹åœ°å€ã€‚ç¡®è®¤åï¼ŒåŒä¸€åœ°å€å°†è‡ªåŠ¨è¿”å›BNBã€‚",
      es: "EnvÃ­a ETH a la siguiente direcciÃ³n. La misma direcciÃ³n devolverÃ¡ automÃ¡ticamente BNB despuÃ©s de la confirmaciÃ³n."
    },
    label: {
      en: "Deposit Address (ETH)",
      ko: "ì…ê¸ˆ ì£¼ì†Œ (ETH)",
      ja: "å…¥é‡‘ã‚¢ãƒ‰ãƒ¬ã‚¹ (ETH)",
      zh: "å…¥é‡‘åœ°å€ï¼ˆETHï¼‰",
      es: "DirecciÃ³n de depÃ³sito (ETH)"
    },
    explorers: {
      en: ["Etherscan (Sender)", "BscScan (Receiver)"],
      ko: ["Etherscan (ë³´ë‚´ëŠ” ì§€ê°‘)", "BscScan (ë°›ëŠ” ì§€ê°‘)"],
      ja: ["Etherscanï¼ˆé€ä¿¡å…ƒï¼‰", "BscScanï¼ˆå—ä¿¡å…ˆï¼‰"],
      zh: ["Etherscanï¼ˆå‘é€åœ°å€ï¼‰", "BscScanï¼ˆæ¥æ”¶åœ°å€ï¼‰"],
      es: ["Etherscan (Remitente)", "BscScan (Receptor)"]
    },
    urls: ["https://etherscan.io/address/","https://bscscan.com/address/"]
  },
  "bnb-pol": {
    title: "BNB â†’ POL",
    desc: {
      en: "Send BNB (BSC) to the address below. The same address will automatically return POL after confirmation.",
      ko: "ì•„ë˜ ì£¼ì†Œë¡œ BNB(BSC)ë¥¼ ë³´ë‚´ì„¸ìš”. í™•ì¸ í›„ ë™ì¼í•œ ì£¼ì†Œë¡œ POLì´ ìë™ ë°˜í™˜ë©ë‹ˆë‹¤.",
      ja: "ä¸‹è¨˜ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«BNB(BSC)ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚ç¢ºèªå¾Œã€åŒã˜ã‚¢ãƒ‰ãƒ¬ã‚¹ã«POLãŒè‡ªå‹•è¿”é€ã•ã‚Œã¾ã™ã€‚",
      zh: "è¯·å°†BNB(BSC)å‘é€è‡³ä»¥ä¸‹åœ°å€ã€‚ç¡®è®¤åï¼ŒåŒä¸€åœ°å€å°†è‡ªåŠ¨è¿”å›POLã€‚",
      es: "EnvÃ­a BNB (BSC) a la siguiente direcciÃ³n. La misma direcciÃ³n devolverÃ¡ automÃ¡ticamente POL despuÃ©s de la confirmaciÃ³n."
    },
    label: {
      en: "Deposit Address (BSC)",
      ko: "ì…ê¸ˆ ì£¼ì†Œ (BSC)",
      ja: "å…¥é‡‘ã‚¢ãƒ‰ãƒ¬ã‚¹ (BSC)",
      zh: "å…¥é‡‘åœ°å€ï¼ˆBSCï¼‰",
      es: "DirecciÃ³n de depÃ³sito (BSC)"
    },
    explorers: {
      en: ["BscScan (Sender)", "Polygonscan (Receiver)"],
      ko: ["BscScan (ë³´ë‚´ëŠ” ì§€ê°‘)", "Polygonscan (ë°›ëŠ” ì§€ê°‘)"],
      ja: ["BscScanï¼ˆé€ä¿¡å…ƒï¼‰", "Polygonscanï¼ˆå—ä¿¡å…ˆï¼‰"],
      zh: ["BscScanï¼ˆå‘é€åœ°å€ï¼‰", "Polygonscanï¼ˆæ¥æ”¶åœ°å€ï¼‰"],
      es: ["BscScan (Remitente)", "Polygonscan (Receptor)"]
    },
    urls: ["https://bscscan.com/address/","https://polygonscan.com/address/"]
  },
  "pol-bnb": {
    title: "POL â†’ BNB",
    desc: {
      en: "Send POL (Polygon) to the address below. The same address will automatically return BNB after confirmation.",
      ko: "ì•„ë˜ ì£¼ì†Œë¡œ POL(Polygon)ì„ ë³´ë‚´ì„¸ìš”. í™•ì¸ í›„ ë™ì¼í•œ ì£¼ì†Œë¡œ BNBê°€ ìë™ ë°˜í™˜ë©ë‹ˆë‹¤.",
      ja: "ä¸‹è¨˜ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«POL(Polygon)ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚ç¢ºèªå¾Œã€åŒã˜ã‚¢ãƒ‰ãƒ¬ã‚¹ã«BNBãŒè‡ªå‹•è¿”é€ã•ã‚Œã¾ã™ã€‚",
      zh: "è¯·å°†POL(Polygon)å‘é€è‡³ä»¥ä¸‹åœ°å€ã€‚ç¡®è®¤åï¼ŒåŒä¸€åœ°å€å°†è‡ªåŠ¨è¿”å›BNBã€‚",
      es: "EnvÃ­a POL (Polygon) a la siguiente direcciÃ³n. La misma direcciÃ³n devolverÃ¡ automÃ¡ticamente BNB despuÃ©s de la confirmaciÃ³n."
    },
    label: {
      en: "Deposit Address (Polygon)",
      ko: "ì…ê¸ˆ ì£¼ì†Œ (Polygon)",
      ja: "å…¥é‡‘ã‚¢ãƒ‰ãƒ¬ã‚¹ (Polygon)",
      zh: "å…¥é‡‘åœ°å€ï¼ˆPolygonï¼‰",
      es: "DirecciÃ³n de depÃ³sito (Polygon)"
    },
    explorers: {
      en: ["Polygonscan (Sender)", "BscScan (Receiver)"],
      ko: ["Polygonscan (ë³´ë‚´ëŠ” ì§€ê°‘)", "BscScan (ë°›ëŠ” ì§€ê°‘)"],
      ja: ["Polygonscanï¼ˆé€ä¿¡å…ƒï¼‰", "BscScanï¼ˆå—ä¿¡å…ˆï¼‰"],
      zh: ["Polygonscanï¼ˆå‘é€åœ°å€ï¼‰", "BscScanï¼ˆæ¥æ”¶åœ°å€ï¼‰"],
      es: ["Polygonscan (Remitente)", "BscScan (Receptor)"]
    },
    urls: ["https://polygonscan.com/address/","https://bscscan.com/address/"]
  }
};

const depositAddress = CONFIG.SERVER_BSC; // ê¸°ì¡´ ë³€ìˆ˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©
const modal = $("#swapModal"), qrDiv = $("#modalQR");

document.querySelectorAll("button[data-type]").forEach(btn => {
  btn.addEventListener("click", () => {
    const type = btn.dataset.type;
    const data = swapPairs[type];
    const lang = currentLang || "en";

    $("#modalTitle").textContent = data.title;
    $("#modalDesc").textContent = data.desc[lang] || data.desc.en;
    $("#modalDepositLabel").textContent = data.label[lang] || data.label.en;
    $("#modalAddress").textContent = depositAddress;

    $("#explorerLinks").innerHTML = `
      ğŸ”— <a href="${data.urls[0] + depositAddress}" target="_blank" class="underline hover:text-emerald-300">${data.explorers[lang][0]}</a><br>
      ğŸ”— <a href="${data.urls[1] + depositAddress}" target="_blank" class="underline hover:text-emerald-300">${data.explorers[lang][1]}</a>
    `;

    qrDiv.innerHTML = "";
    new QRCode(qrDiv, { text: depositAddress, width: 140, height: 140, correctLevel: QRCode.CorrectLevel.M });
    modal.classList.remove("hidden");
  });
});

$("#closeModal").addEventListener("click", () => modal.classList.add("hidden"));
modal.addEventListener("click", e => { if (e.target === modal) modal.classList.add("hidden"); });
$("#copyAddr").addEventListener("click", async () => {
  await navigator.clipboard.writeText(depositAddress);
  const b = $("#copyAddr");
  const old = b.textContent;
  b.textContent = "Copied!";
  b.classList.add("border-emerald-500");
  setTimeout(() => { b.textContent = old; b.classList.remove("border-emerald-500"); }, 1500);
});
</script>

</body>
</html>

