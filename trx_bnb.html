<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GasSwap – TRX → BNB (BSC)</title>
  <meta name="description" content="Deposit TRX and receive BNB (BSC) automatically. Simple cross-chain swap request UI." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    a { word-break: break-all; }
    .flag-btn { font-size: 20px; cursor: pointer; opacity: 0.7; transition: 0.2s; }
    .flag-btn:hover { opacity: 1; transform: scale(1.1); }
    .flag-active { opacity: 1; border-bottom: 2px solid #34d399; }
  </style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">

<!-- HEADER -->
<header class="border-b border-slate-800 bg-slate-900/60 backdrop-blur sticky top-0 z-20">
  <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <div class="flex items-center gap-2">
      <div class="w-8 h-8 rounded-xl bg-gradient-to-tr from-emerald-400 to-cyan-400"></div>
      <h1 class="text-lg font-semibold tracking-tight">GasSwap</h1>
      <span class="ml-2 text-xs text-slate-400">v1.0</span>
    </div>
    <div class="flex items-center gap-3 text-lg">
      <span class="flag-btn" data-lang="en">🇺🇸</span>
      <span class="flag-btn" data-lang="ko">🇰🇷</span>
      <span class="flag-btn" data-lang="ja">🇯🇵</span>
      <span class="flag-btn" data-lang="zh">🇨🇳</span>
      <span class="flag-btn" data-lang="es">🇪🇸</span>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-5xl mx-auto px-4 py-8">
  <section class="rounded-2xl border border-slate-800 bg-slate-900 p-6 mb-6 text-center">
    <h2 id="title" class="text-2xl font-semibold mb-1">TRX → BNB (BSC)</h2>
    <h3 class="text-sm text-slate-500 tracking-wide mb-2">Cross-Chain Swap</h3>
    <p id="subtitle" class="text-slate-400 text-sm">Deposit TRX and receive BNB (BSC) automatically after confirmation.</p>
  </section>

  <!-- FORM + SESSION -->
  <section class="grid md:grid-cols-2 gap-6">
    <div class="rounded-2xl border border-slate-800 bg-slate-900 p-5">
      <h3 id="formTitle" class="text-lg font-semibold mb-4">Please fill this form before sending your tokens</h3>
      <form id="swapForm" class="space-y-4" novalidate>
        <div>
          <label id="labelSender" class="block text-sm mb-1">Sender (TRX)</label>
          <input id="sender" type="text" class="w-full rounded-xl bg-slate-950 border border-slate-800 focus:border-emerald-400 px-4 py-3 text-sm" placeholder="T…" required />
        </div>
        <div>
          <label id="labelReceiver" class="block text-sm mb-1">Receiver (BNB BSC)</label>
          <input id="receiver" type="text" class="w-full rounded-xl bg-slate-950 border border-slate-800 focus:border-emerald-400 px-4 py-3 text-sm" placeholder="0x…" required />
        </div>
        <div id="formError" class="hidden rounded-xl border border-red-500/40 bg-red-500/10 text-red-200 text-sm px-3 py-2"></div>
        <button id="startBtn" type="submit" class="w-full rounded-xl px-4 py-3 bg-emerald-500 text-slate-950 font-semibold hover:bg-emerald-400 focus:outline-none">Start Swap</button>
      </form>

      <!-- EXPLORERS -->
      <div id="userExplorers" class="hidden mt-5 text-sm text-slate-400 space-y-2 w-[95%] mx-auto">
        <div id="youCanCheck">Check Explorers:</div>
        <div>🔗 <a id="userTrxLink" target="_blank" class="underline hover:text-emerald-300">Tronscan(Sender)</a></div>
        <div>🔗 <a id="userBscLink" target="_blank" class="underline hover:text-emerald-300">BscScan(Receiver)</a></div>
      </div>
    </div>

    <!-- SESSION -->
    <div class="rounded-2xl border border-slate-800 bg-slate-900 p-5">
      <h3 id="sessionTitle" class="text-lg font-semibold mb-4">Deposit session</h3>
      <div id="inactiveHint" class="text-sm text-slate-400">
        Fill the form and press <span class="font-semibold">Start Swap</span> to generate your session.
      </div>
      <div id="sessionPanel" class="hidden space-y-4">
        <div>
          <div class="text-xs text-slate-400" id="depositTo">Deposit to (fixed address)</div>
          <div class="mt-1 flex items-center gap-2">
            <code id="depositAddress" class="text-emerald-200 break-all"></code>
            <button id="copyDeposit" class="text-xs px-2 py-1 rounded-lg border border-slate-700 hover:bg-slate-800">Copy</button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <div id="qr" class="bg-white p-2 inline-block rounded-xl"></div>
            <div class="text-[10px] text-slate-500 mt-1" id="scanToDeposit">Scan to deposit</div>
          </div>
          <div>
            <div class="text-xs text-slate-400" id="deadlineLabel">Deposit deadline</div>
            <div id="countdown" class="text-3xl font-mono mt-1 text-right">60:00</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- NOTICE -->
  <section class="mt-8 text-center">
    <div id="noticeBox" class="bg-yellow-500/10 border border-yellow-500/40 text-yellow-200 rounded-xl p-4 text-sm leading-relaxed">
      ⚠️ For security: deposits under 1 USDT or above 20 USDT are not accepted.
    </div>
  </section>
</main>

<footer class="mt-10 py-10 text-center text-xs text-slate-500">© <span id="year"></span> GasSwap</footer>

<script>
const CONFIG = {
  FORM_ENDPOINT: "https://gasswap-proxy.workers.dev",
  SERVER_TRX: "TDhFfK9nXvdp2kUq3pP7b3p7aYjV3kJb7T", // deposit address
  SESSION_SECONDS: 3600
};

const I18N = {
  en:{title:"TRX → BNB (BSC)",subtitle:"Deposit TRX and receive BNB (BSC) automatically after confirmation.",
    formTitle:"Please fill this form before sending your tokens",
    labelSender:"Sender (TRX)",labelReceiver:"Receiver (BNB BSC)",
    start:"Start Swap",sessionTitle:"Deposit session",
    depositTo:"Deposit to (fixed address)",scanToDeposit:"Scan to deposit",
    deadlineLabel:"Deposit deadline",
    youCanCheck:"Check Explorers:",viewTrx:"Tronscan(Sender)",viewBsc:"BscScan(Receiver)",
    notice:"⚠️ For security: deposits under 1 USDT or above 20 USDT are not accepted.",
    err_sender:"Invalid TRX address",err_receiver:"Invalid BSC address"},
  ko:{title:"TRX → BNB (BSC)",subtitle:"TRX를 입금하면 확인 후 BNB(BSC)가 자동 전송됩니다.",
    formTitle:"토큰을 보내기 전에 먼저 작성하세요",
    labelSender:"보내는 지갑 (TRX)",labelReceiver:"받는 지갑 (BNB BSC)",
    start:"스왑 시작하기",sessionTitle:"입금 세션",
    depositTo:"입금 주소 (고정)",scanToDeposit:"입금용 QR 코드",
    deadlineLabel:"입금 제한시간",youCanCheck:"탐색기에서 확인하기:",
    viewTrx:"Tronscan (보내는 지갑)",viewBsc:"BscScan (받는 지갑)",
    notice:"⚠️ 보안을 위해 1 USDT 미만 또는 20 USDT 초과 입금은 허용되지 않습니다.",
    err_sender:"TRX 주소가 올바르지 않습니다.",err_receiver:"BSC 주소가 올바르지 않습니다."},
  ja:{title:"TRX → BNB (BSC)",subtitle:"TRXを入金すると、確認後にBNB(BSC)が自動送付されます。",
    formTitle:"トークンを送る前にこのフォームを記入してください",
    labelSender:"送信元 (TRX)",labelReceiver:"受信先 (BNB BSC)",
    start:"スワップ開始",sessionTitle:"入金セッション",
    depositTo:"入金先アドレス (固定)",scanToDeposit:"入金用QRコード",
    deadlineLabel:"入金期限",youCanCheck:"エクスプローラーを確認:",
    viewTrx:"Tronscan（送信元）",viewBsc:"BscScan（受信先）",
    notice:"⚠️ セキュリティのため、1 USDT未満または20 USDT超の入金は受け付けません。",
    err_sender:"無効なTRXアドレスです。",err_receiver:"無効なBSCアドレスです。"},
  zh:{title:"TRX → BNB (BSC)",subtitle:"入金 TRX，确认后自动收到 BNB(BSC)。",
    formTitle:"请在发送代币前填写此表单",
    labelSender:"发送地址 (TRX)",labelReceiver:"接收地址 (BNB BSC)",
    start:"开始兑换",sessionTitle:"入金会话",
    depositTo:"入金地址（固定）",scanToDeposit:"扫描二维码入金",
    deadlineLabel:"入金截止时间",youCanCheck:"查看区块浏览器：",
    viewTrx:"Tronscan（发送地址）",viewBsc:"BscScan（接收地址）",
    notice:"⚠️ 为安全起见，请勿转入1 USDT以下或20 USDT以上金额。",
    err_sender:"无效的 TRX 地址",err_receiver:"无效的 BSC 地址"},
  es:{title:"TRX → BNB (BSC)",subtitle:"Deposita TRX y recibe BNB (BSC) automáticamente tras la confirmación.",
    formTitle:"Por favor completa este formulario antes de enviar tus tokens",
    labelSender:"Remitente (TRX)",labelReceiver:"Receptor (BNB BSC)",
    start:"Iniciar intercambio",sessionTitle:"Sesión de depósito",
    depositTo:"Depositar en (dirección fija)",scanToDeposit:"Escanear para depositar",
    deadlineLabel:"Plazo de depósito",youCanCheck:"Ver exploradores:",
    viewTrx:"Tronscan (Remitente)",viewBsc:"BscScan (Receptor)",
    notice:"⚠️ Por seguridad, no se aceptan depósitos menores a 1 USDT o mayores a 20 USDT.",
    err_sender:"Dirección TRX inválida",err_receiver:"Dirección BSC inválida"}
};

const $=s=>document.querySelector(s);
const isEVM=a=>/^0x[0-9a-fA-F]{40}$/.test(a||"");
const isTRX=a=>/^T[1-9A-HJ-NP-Za-km-z]{33}$/.test(a||"");
let currentLang="en";

async function detectLang(){
  try{
    const r=await fetch("https://ipapi.co/json/");
    const j=await r.json();
    const c=(j.country_code||"").toUpperCase();
    if(c==="KR")return"ko";if(c==="JP")return"ja";
    if(["CN","TW","HK","MO"].includes(c))return"zh";
    if(["ES","MX","AR","CO","CL","PE"].includes(c))return"es";
    return"en";
  }catch{return"en";}
}

function applyLang(){
  const t=I18N[currentLang];
  $("#title").textContent=t.title;
  $("#subtitle").textContent=t.subtitle;
  $("#formTitle").textContent=t.formTitle;
  $("#labelSender").textContent=t.labelSender;
  $("#labelReceiver").textContent=t.labelReceiver;
  $("#startBtn").textContent=t.start;
  $("#sessionTitle").textContent=t.sessionTitle;
  $("#depositTo").textContent=t.depositTo;
  $("#scanToDeposit").textContent=t.scanToDeposit;
  $("#deadlineLabel").textContent=t.deadlineLabel;
  $("#youCanCheck").textContent=t.youCanCheck;
  $("#userTrxLink").textContent=t.viewTrx;
  $("#userBscLink").textContent=t.viewBsc;
  $("#noticeBox").textContent=t.notice;
}

function makeQR(text){$("#qr").innerHTML="";new QRCode($("#qr"),{text,width:160,height:160,correctLevel:QRCode.CorrectLevel.M});}

function showSession(){
  $("#inactiveHint").classList.add("hidden");
  $("#sessionPanel").classList.remove("hidden");
  $("#depositAddress").textContent=CONFIG.SERVER_TRX;
  makeQR(CONFIG.SERVER_TRX);
  const explorers=$("#userExplorers");
  if(explorers){explorers.classList.remove("hidden");explorers.style.marginTop="12px";}
}

async function updateForms(sender,receiver){
  const repo="GasSwap/gasswap-data";
  const path="data/forms2.json";
  const url=`https://api.github.com/repos/${repo}/contents/${path}`;
  const res=await fetch(CONFIG.FORM_ENDPOINT,{
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({sender,receiver,repo,path,url})
  });
  if(res.ok)alert("✅ Swap request saved (forms2.json)!");
  else alert("❌ Error: "+await res.text());
}

document.addEventListener("DOMContentLoaded",async()=>{
  $("#year").textContent=new Date().getFullYear();
  currentLang=await detectLang();applyLang();
  document.querySelectorAll(".flag-btn").forEach(f=>f.addEventListener("click",()=>{currentLang=f.dataset.lang;applyLang();}));
  $("#copyDeposit").addEventListener("click",async()=>{
    await navigator.clipboard.writeText($("#depositAddress").textContent.trim());
    const b=$("#copyDeposit"),old=b.textContent;
    b.textContent="Copied!";b.classList.add("border-emerald-500");
    setTimeout(()=>{b.textContent=old;b.classList.remove("border-emerald-500");},1500);
  });
  $("#swapForm").addEventListener("submit",async e=>{
    e.preventDefault();
    const sender=$("#sender").value.trim(),receiver=$("#receiver").value.trim(),err=$("#formError");
    if(!isTRX(sender)){err.textContent=I18N[currentLang].err_sender;err.classList.remove("hidden");return;}
    if(!isEVM(receiver)){err.textContent=I18N[currentLang].err_receiver;err.classList.remove("hidden");return;}
    err.classList.add("hidden");$("#startBtn").disabled=true;
    $("#startBtn").classList.add("opacity-50","cursor-not-allowed");
    showSession();
    $("#userTrxLink").href=`https://tronscan.org/#/address/${sender}`;
    $("#userBscLink").href=`https://bscscan.com/address/${receiver}`;
    await updateForms(sender,receiver);
  });
});
</script>
</body>
</html>
